<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 9: Build Your Own - PCCL Guide</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="sidebar">
        <div class="book-title">ğŸ“š PCCL Guide</div>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="chapter0-prerequisites.html">0. Prerequisites</a></li>
            <li><a href="chapter1-introduction.html">1. The Problem</a></li>
            <li><a href="chapter2-architecture.html">2. Architecture</a></li>
            <li><a href="chapter3-state-machines.html">3. State Machines</a></li>
            <li><a href="chapter4-ring-allreduce.html">4. Ring All-Reduce</a></li>
            <li><a href="chapter5-fault-tolerance.html">5. Fault Tolerance</a></li>
            <li><a href="chapter6-diloco.html">6. DiLoCo Family</a></li>
            <li><a href="chapter7-implementation.html">7. Implementation</a></li>
            <li><a href="chapter8-benchmarks.html">8. Benchmarks</a></li>
            <li><a href="chapter9-build-your-own.html" class="active">9. Build Your Own</a></li>
            <li><a href="chapter10-deployment.html">10. Deployment</a></li>
            <li><a href="appendix-alternatives.html">A. Alternatives</a></li>
        </ul>
    </nav>
    <main class="content">
        <h1>Chapter 9: Build Your Own</h1>
        <p class="subtitle">HLD, LLD, Class Diagrams & Implementation Roadmap</p>

        <h2>High-Level Design (HLD)</h2>
        
        <div class="remember-this">
            <h3>ğŸ’¡ System Overview</h3>
            <p>PCCL consists of 3 main components communicating over TCP/IP:</p>
            <ul>
                <li><strong>Master Server</strong> - Coordination & consensus</li>
                <li><strong>Peer Client</strong> - Training & collective operations</li>
                <li><strong>P2P Mesh</strong> - Direct data transfer between peers</li>
            </ul>
        </div>

        <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HIGH-LEVEL ARCHITECTURE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  MASTER SERVER  â”‚
                           â”‚                 â”‚
                           â”‚ â€¢ Membership    â”‚
                           â”‚ â€¢ Consensus     â”‚
                           â”‚ â€¢ Topology      â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    Control Plane   â”‚   (lightweight messages)
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                          â”‚                          â”‚
         â–¼                          â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PEER CLIENT   â”‚      â”‚   PEER CLIENT   â”‚      â”‚   PEER CLIENT   â”‚
â”‚                 â”‚      â”‚                 â”‚      â”‚                 â”‚
â”‚ â€¢ Model/Grads   â”‚â—„â”€â”€â”€â”€â–ºâ”‚ â€¢ Model/Grads   â”‚â—„â”€â”€â”€â”€â–ºâ”‚ â€¢ Model/Grads   â”‚
â”‚ â€¢ Optimizer     â”‚      â”‚ â€¢ Optimizer     â”‚      â”‚ â€¢ Optimizer     â”‚
â”‚ â€¢ Collectives   â”‚      â”‚ â€¢ Collectives   â”‚      â”‚ â€¢ Collectives   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                          â–²                          â–²
         â”‚                          â”‚                          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           Data Plane (P2P Mesh)
                           (heavy tensor data)
        </div>

        <h3>Component Responsibilities</h3>
        <table>
            <tr><th>Component</th><th>Responsibilities</th><th>Communicates With</th></tr>
            <tr>
                <td>Master Server</td>
                <td>Track peers, coordinate state transitions, optimize topology</td>
                <td>All Peers (control)</td>
            </tr>
            <tr>
                <td>Peer Client</td>
                <td>Hold model weights, run training, execute collectives</td>
                <td>Master + Other Peers</td>
            </tr>
            <tr>
                <td>P2P Connection</td>
                <td>Transfer tensor data directly between peers</td>
                <td>Peer â†” Peer only</td>
            </tr>
        </table>

        <h2>Entity Relationship Diagram</h2>

        <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ENTITY RELATIONSHIP DIAGRAM                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       1:N        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Master    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚     Peer     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id           â”‚                  â”‚ id (rank)    â”‚
â”‚ address      â”‚                  â”‚ address      â”‚
â”‚ port         â”‚                  â”‚ port         â”‚
â”‚ topology     â”‚                  â”‚ phase        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ state        â”‚
                                  â”‚ hash         â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â”‚ N:N
                                         â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ P2PConnectionâ”‚
                                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                                  â”‚ peer_a_id    â”‚
                                  â”‚ peer_b_id    â”‚
                                  â”‚ bandwidth    â”‚
                                  â”‚ latency      â”‚
                                  â”‚ socket       â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â”‚ 1:N
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       N:1        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Operation   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    Tensor    â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (tag)     â”‚                  â”‚ id           â”‚
â”‚ type         â”‚                  â”‚ data_ptr     â”‚
â”‚ state        â”‚                  â”‚ size         â”‚
â”‚ participants â”‚                  â”‚ dtype        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ device       â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <h2>Low-Level Design (LLD)</h2>

        <h3>Phase 1: Core Infrastructure</h3>

        <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PHASE 1: CLASS DIAGRAM - CORE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           TcpServer             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - address: String               â”‚
â”‚ - port: u16                     â”‚
â”‚ - listener: TcpListener         â”‚
â”‚ - connections: Vec<TcpStream>   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + bind(addr, port)              â”‚
â”‚ + accept() -> Connection        â”‚
â”‚ + broadcast(msg)                â”‚
â”‚ + shutdown()                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–²
              â”‚ uses
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Master                â”‚      â”‚         Peer                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - peers: HashMap<PeerId, Peer>  â”‚      â”‚ - id: PeerId                    â”‚
â”‚ - topology: RingTopology        â”‚      â”‚ - phase: ConnectionPhase        â”‚
â”‚ - state: MasterState            â”‚      â”‚ - state: ConnectionState        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚ - master_conn: TcpStream        â”‚
â”‚ + register_peer(peer)           â”‚      â”‚ - p2p_conns: Vec<P2PConnection> â”‚
â”‚ + accept_peer(peer_id)          â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + remove_peer(peer_id)          â”‚      â”‚ + connect_master(addr)          â”‚
â”‚ + broadcast_abort(op_id)        â”‚      â”‚ + connect_peer(peer_id)         â”‚
â”‚ + optimize_topology()           â”‚      â”‚ + send_to_master(msg)           â”‚
â”‚ + get_ring_order() -> Vec       â”‚      â”‚ + recv_from_master() -> Msg     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â”‚ has
                                                       â–¼
                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                         â”‚       P2PConnection             â”‚
                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                         â”‚ - remote_peer_id: PeerId        â”‚
                                         â”‚ - socket: TcpStream             â”‚
                                         â”‚ - send_buffer: Vec<u8>          â”‚
                                         â”‚ - recv_buffer: Vec<u8>          â”‚
                                         â”‚ - bandwidth: f64                â”‚
                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                         â”‚ + send(data: &[u8])             â”‚
                                         â”‚ + recv(buf: &mut [u8])          â”‚
                                         â”‚ + measure_bandwidth() -> f64    â”‚
                                         â”‚ + close()                       â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <h3>State Machine Classes</h3>

        <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATE ENUMS & TRANSITIONS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ConnectionPhase    â”‚     â”‚  ConnectionState    â”‚     â”‚  CollectiveState    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Registered        â”‚     â”‚ â€¢ Idle              â”‚     â”‚ â€¢ VoteInitiate      â”‚
â”‚ â€¢ Accepted          â”‚     â”‚ â€¢ VotingAcceptPeers â”‚     â”‚ â€¢ Performing        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â€¢ SyncingState      â”‚     â”‚ â€¢ VoteComplete      â”‚
                            â”‚ â€¢ CollectiveRunning â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

State Transition Rules:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Registered â”€â”€[vote passes]â”€â”€â–º Accepted

Idle â”€â”€[peers pending]â”€â”€â–º VotingAcceptPeers â”€â”€[vote done]â”€â”€â–º Idle
Idle â”€â”€[hash mismatch]â”€â”€â–º SyncingState â”€â”€[sync done]â”€â”€â–º Idle
Idle â”€â”€[start collective]â”€â”€â–º CollectiveRunning â”€â”€[complete]â”€â”€â–º Idle

VoteInitiate â”€â”€[all agree]â”€â”€â–º Performing â”€â”€[done]â”€â”€â–º VoteComplete â”€â”€[all ack]â”€â”€â–º (end)
        </div>

        <h3>Phase 2: Collective Operations</h3>

        <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 PHASE 2: CLASS DIAGRAM - COLLECTIVES                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚      CollectiveOperation        â”‚ (abstract)
                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                         â”‚ - tag: u32                      â”‚
                         â”‚ - state: CollectiveState        â”‚
                         â”‚ - participants: Vec<PeerId>     â”‚
                         â”‚ - buffer_backup: Option<Vec>    â”‚
                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                         â”‚ + execute() -> Result           â”‚
                         â”‚ + abort()                       â”‚
                         â”‚ + restore_backup()              â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                    â”‚                    â”‚
                    â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      AllReduce        â”‚  â”‚      Broadcast        â”‚  â”‚      AllGather        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - reduce_op: ReduceOp â”‚  â”‚ - root: PeerId        â”‚  â”‚ - recv_counts: Vec    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + reduce_scatter()    â”‚  â”‚ + execute()           â”‚  â”‚ + execute()           â”‚
â”‚ + all_gather()        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ + execute()           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ReduceOp               â”‚     â”‚        RingTopology             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Sum                           â”‚     â”‚ - order: Vec<PeerId>            â”‚
â”‚ â€¢ Avg                           â”‚     â”‚ - bandwidth_matrix: Matrix      â”‚
â”‚ â€¢ Min                           â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Max                           â”‚     â”‚ + get_next(peer) -> PeerId      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ + get_prev(peer) -> PeerId      â”‚
                                        â”‚ + optimize() -> Vec<PeerId>     â”‚
                                        â”‚ + compute_chunk_bounds(n) -> Vecâ”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <h3>Phase 3: Fault Tolerance</h3>

        <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               PHASE 3: CLASS DIAGRAM - FAULT TOLERANCE                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        FailureDetector          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - heartbeat_interval: Duration  â”‚
â”‚ - timeout: Duration             â”‚
â”‚ - last_seen: HashMap<PeerId, T> â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + start_monitoring()            â”‚
â”‚ + record_heartbeat(peer_id)     â”‚
â”‚ + get_failed_peers() -> Vec     â”‚
â”‚ + is_alive(peer_id) -> bool     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        AbortController          â”‚     â”‚       StateRecovery             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - abort_flag: AtomicBool        â”‚     â”‚ - backup_store: HashMap         â”‚
â”‚ - abort_reason: Option<Error>   â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚ + save_backup(op_id, data)      â”‚
â”‚ + signal_abort(reason)          â”‚     â”‚ + restore_backup(op_id) -> Data â”‚
â”‚ + check_abort() -> bool         â”‚     â”‚ + clear_backup(op_id)           â”‚
â”‚ + reset()                       â”‚     â”‚ + has_backup(op_id) -> bool     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        SharedStateSync          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - hasher: SimpleHash            â”‚
â”‚ - local_hash: u64               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + compute_hash(tensors) -> u64  â”‚
â”‚ + compare_hashes(peers) -> Vec  â”‚  (returns outliers)
â”‚ + sync_from_peer(peer_id)       â”‚
â”‚ + sync_to_peer(peer_id)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <h2>Sequence Diagrams</h2>

        <h3>Peer Join Flow</h3>

        <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SEQUENCE: PEER JOIN                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  NewPeer              Master              ExistingPeers
     â”‚                    â”‚                      â”‚
     â”‚â”€â”€â”€â”€ connect() â”€â”€â”€â”€â–ºâ”‚                      â”‚
     â”‚                    â”‚                      â”‚
     â”‚â—„â”€â”€â”€ REGISTERED â”€â”€â”€â”€â”‚                      â”‚
     â”‚                    â”‚                      â”‚
     â”‚                    â”‚â—„â”€â”€ vote_accept? â”€â”€â”€â”€â”€â”‚
     â”‚                    â”‚                      â”‚
     â”‚                    â”‚â”€â”€â”€â”€ vote_accept â”€â”€â”€â”€â–ºâ”‚
     â”‚                    â”‚                      â”‚
     â”‚                    â”‚â—„â”€â”€â”€ all_agree â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                    â”‚                      â”‚
     â”‚â—„â”€â”€â”€ ACCEPTED â”€â”€â”€â”€â”€â”€â”‚                      â”‚
     â”‚                    â”‚                      â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ establish P2P â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                    â”‚                      â”‚
     â”‚                    â”‚â—„â”€â”€ sync_state â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ receive state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                    â”‚                      â”‚
     â”‚                READY TO PARTICIPATE       â”‚
     â–¼                    â–¼                      â–¼
        </div>

        <h3>All-Reduce Flow</h3>

        <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SEQUENCE: ALL-REDUCE                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Peer0           Peer1           Peer2           Master
    â”‚               â”‚               â”‚               â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ vote_initiate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ all_agreed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚ backup_buffer â”‚ backup_buffer â”‚ backup_buffer â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚ â•â•â•â•â•â•â•â•â•â• REDUCE-SCATTER (N-1 steps) â•â•â•â•â•â• â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚â”€â”€â”€â”€ chunk â”€â”€â”€â–ºâ”‚               â”‚               â”‚
    â”‚               â”‚â”€â”€â”€â”€ chunk â”€â”€â”€â–ºâ”‚               â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ chunk â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚   (accumulate received chunks locally)       â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚ â•â•â•â•â•â•â•â•â•â• ALL-GATHER (N-1 steps) â•â•â•â•â•â•â•â•â•â•â•â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚â”€â”€â”€â”€ chunk â”€â”€â”€â–ºâ”‚               â”‚               â”‚
    â”‚               â”‚â”€â”€â”€â”€ chunk â”€â”€â”€â–ºâ”‚               â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ chunk â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ vote_complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ all_acked â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚ clear_backup  â”‚ clear_backup  â”‚ clear_backup  â”‚
    â–¼               â–¼               â–¼               â–¼
        </div>

        <h3>Failure Recovery Flow</h3>

        <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SEQUENCE: FAILURE DURING COLLECTIVE                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Peer0           Peer1(dies)      Peer2           Master
    â”‚               â”‚               â”‚               â”‚
    â”‚ â•â•â•â•â•â•â•â•â•â• ALL-REDUCE IN PROGRESS â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚â”€â”€â”€â”€ chunk â”€â”€â”€â–ºâ”‚ CRASH! ğŸ’€     â”‚               â”‚
    â”‚               X               â”‚               â”‚
    â”‚               X               â”‚               â”‚
    â”‚   (timeout waiting for Peer1)                â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ report_failure â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ABORT signal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚               â”‚               â”‚â—„â”€â”€â”€â”€â”€ ABORT â”€â”€â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚ restore_backupâ”‚               â”‚ restore_backupâ”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚               â”‚               â”‚â—„â”€ remove_peerâ”€â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ topology_update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚ â•â•â•â•â•â•â•â•â•â• RETRY ALL-REDUCE (2 peers) â•â•â•â•â•â• â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
    â”‚               â”‚               â”‚               â”‚
    â”‚            SUCCESS!           â”‚               â”‚
    â–¼                               â–¼               â–¼
        </div>

        <h2>Language Showdown</h2>
        
        <div class="fireside-chat">
            <div class="chat-message"><span class="chat-speaker">Rust:</span> "Memory safety WITHOUT garbage collection. I'm the future!"</div>
            <div class="chat-message"><span class="chat-speaker">C++:</span> "I'm what PCCL actually uses. Maximum control."</div>
            <div class="chat-message"><span class="chat-speaker">Go:</span> "Great for the master node! Goroutines are perfect for coordination."</div>
            <div class="chat-message"><span class="chat-speaker">Python:</span> "I'm just here for the bindings. Let the grown-ups do the real work."</div>
        </div>

        <h2>Recommended Stack</h2>
        <table>
            <tr><th>Component</th><th>Language</th><th>Why</th></tr>
            <tr><td>Core Library</td><td>Rust or C++</td><td>Performance, memory control</td></tr>
            <tr><td>Master Node</td><td>Go or Rust</td><td>Concurrency, simplicity</td></tr>
            <tr><td>Python Bindings</td><td>PyO3 / pybind11</td><td>PyTorch integration</td></tr>
        </table>

        <h2>Implementation Checklist</h2>
        <div class="bullet-points">
            <h3>Phase 1: Core Infrastructure</h3>
            <ul>
                <li>â˜ TcpServer / TcpClient classes</li>
                <li>â˜ Master with peer registry</li>
                <li>â˜ Peer with master connection</li>
                <li>â˜ P2PConnection class</li>
                <li>â˜ ConnectionPhase enum</li>
                <li>â˜ ConnectionState enum</li>
                <li>â˜ Message serialization (protobuf/msgpack)</li>
            </ul>
            <h3>Phase 2: Collective Operations</h3>
            <ul>
                <li>â˜ RingTopology class</li>
                <li>â˜ CollectiveOperation base class</li>
                <li>â˜ AllReduce (reduce-scatter + all-gather)</li>
                <li>â˜ ReduceOp enum (Sum, Avg, Min, Max)</li>
                <li>â˜ CollectiveState enum</li>
                <li>â˜ Async operation support</li>
                <li>â˜ Multiple concurrent operations</li>
            </ul>
            <h3>Phase 3: Fault Tolerance</h3>
            <ul>
                <li>â˜ FailureDetector (heartbeat-based)</li>
                <li>â˜ AbortController (atomic flag)</li>
                <li>â˜ StateRecovery (backup/restore)</li>
                <li>â˜ SharedStateSync (hash comparison)</li>
                <li>â˜ SimpleHash implementation</li>
                <li>â˜ Graceful peer removal</li>
                <li>â˜ Operation retry logic</li>
            </ul>
            <h3>Phase 4: Optimization</h3>
            <ul>
                <li>â˜ Bandwidth measurement</li>
                <li>â˜ ATSP solver for ring order</li>
                <li>â˜ Connection pooling</li>
                <li>â˜ Quantization support</li>
            </ul>
            <h3>Phase 5: Integration</h3>
            <ul>
                <li>â˜ Python bindings (PyO3/pybind11)</li>
                <li>â˜ PyTorch tensor support</li>
                <li>â˜ CUDA memory handling</li>
                <li>â˜ Stress testing</li>
            </ul>
        </div>

        <div class="navigation">
            <a href="chapter8-benchmarks.html" class="prev">â† Benchmarks</a>
            <a href="chapter10-deployment.html" class="next">Next: Deployment â†’</a>
        </div>
    </main>
    <aside class="glossary-sidebar">
        <div class="glossary-title">ğŸ“– Jargon Buster</div>
        <div class="glossary-item">
            <div class="glossary-term">HLD</div>
            <div class="glossary-def">High-Level Design. Bird's eye view of system components and their interactions.</div>
        </div>
        <div class="glossary-item">
            <div class="glossary-term">LLD</div>
            <div class="glossary-def">Low-Level Design. Detailed class structures, methods, and data types.</div>
        </div>
        <div class="glossary-item">
            <div class="glossary-term">ERD</div>
            <div class="glossary-def">Entity Relationship Diagram. Shows data entities and their relationships.</div>
        </div>
        <div class="glossary-item">
            <div class="glossary-term">Sequence Diagram</div>
            <div class="glossary-def">Shows message flow between components over time.</div>
        </div>
        <div class="glossary-item">
            <div class="glossary-term">Control Plane</div>
            <div class="glossary-def">Lightweight coordination messages (Master â†” Peers).</div>
        </div>
        <div class="glossary-item">
            <div class="glossary-term">Data Plane</div>
            <div class="glossary-def">Heavy tensor data transfer (Peer â†” Peer).</div>
        </div>
        <div class="glossary-item">
            <div class="glossary-term">PyO3</div>
            <div class="glossary-def">Rust library for Python bindings. Fast and safe!</div>
        </div>
        <div class="glossary-item">
            <div class="glossary-term">pybind11</div>
            <div class="glossary-def">C++ library for Python bindings. Industry standard.</div>
        </div>
        <div class="glossary-item">
            <div class="glossary-term">ATSP</div>
            <div class="glossary-def">Asymmetric Traveling Salesman Problem. Used for ring optimization.</div>
        </div>
        <div class="glossary-item">
            <div class="glossary-term">Protobuf</div>
            <div class="glossary-def">Protocol Buffers. Google's binary serialization format.</div>
        </div>
        <div class="glossary-item">
            <div class="glossary-term">AtomicBool</div>
            <div class="glossary-def">Thread-safe boolean. Used for abort flags without locks.</div>
        </div>
    </aside>
</body>
</html>
